<h1>
  <%= @contest.title %>
</h1>
<h3>
<%= @contest.end_time%>

    <div class="timer" id="year"></div>
    <div class="timer" id="month"></div>
    <div class="timer" id="day"></div>
    <div class="timer" id="hour"></div>
    <div class="timer" id="min"></div>
    <div class="timer" id="sec"></div>
  </h3>
<% if Time.now > @contest.start_time and Time.now > @contest.end_time %>
  <%= render partial: "contests/partials/pending_contest",  locals: { products: @products, contest: @contest } %>
<% elsif Time.now > @contest.start_time and Time.now < @contest.end_time %>
  <%= render partial: "contests/partials/standing_contest", locals: { products: @products, contest: @contest, vote: @vote } %>
<% else %>
  <%= render partial: "contests/partials/finished_contest", locals: { products: @products, contest: @contest, chart: @chart } %>
<% end %>

<script>

<% t = @contest.end_time %>
console.log("called!!")
end = new Date(<%= t.year %>, <%= t.month %>, <%= t.day %>, <%= t.hour %>, <%= t.min %>)

console.log(end)
increaseTime = function(){
  var now = new Date()
  console.log("end time >>")
  console.log({end: end})
  console.log("now time >>")
  console.log({now:now})
  var calc = new Date(end-now);
  console.log(calc.getUTCFullYear() - 1970 + "年");
  $('div#year')[0].textContent = calc.getUTCFullYear() - 1970 + 'y'
  console.log(calc.getUTCMonth() + "カ月");
  $('div#month')[0].textContent = calc.getUTCMonth() + 'm'
  console.log(calc.getUTCDate() - 1 + "日");
  $('div#day')[0].textContent = calc.getUTCDate() + 'd'
  console.log(calc.getUTCHours() + "時間");
  $('div#hour')[0].textContent = calc.getUTCHours() + 'h'
  console.log(calc.getUTCMinutes() + "分");
  $('div#min')[0].textContent = calc.getUTCMinutes() + 'm'
  console.log(calc.getUTCSeconds() + "秒");
  $('div#sec')[0].textContent = calc.getUTCSeconds() + 's'
}
increaseTime()
setInterval(increaseTime, 1000);

// 指定したindexの番号を消します
clean_select = function(index) {
  for(var i = 0 ; i < 3 ; i ++){
    if($('div.select')[i].textContent == index + 1){
      $('div.select')[i].textContent = 'なし'
    }
  }
}

// 
pack_select = function() {
  var now, str = '';
  for(var i = 0, now = 0 ; i < 3 ; i ++){
    if($('div.select')[i].textContent != 'なし'){
      $('div.select')[now].textContent = $('div.select')[i].textContent
      str += $('div.select')[i].textContent + ', '
      now ++
    }      
  }
  console.log(str)

  $('input.selected_id')[0].value = str
  console.log($('input.selected_id')[0].value)
  for( ; now < 3 ; now ++){
    $('div.select')[now].textContent = 'なし'
  }
}

$('div.card-image').on('click', function(){
  point = Number($('div.vote_count')[0].textContent)
  var index = $('div.card-image').index(this);
  if(!$(this).hasClass('active')){ // 選択する
    console.log([point, index])
    $('div.select')[3-point].textContent = index + 1
    if(point != 0){
      $(this).parent().css("border", "1px solid #ff0000")
      $(this).toggleClass('active')
      point --
    }
  } else { // 選択を外す
    clean_select(index)
    $(this).parent().css("border", "none")
    $(this).toggleClass('active')
    point ++
  }
  pack_select()
  console.log(index + 'th item clicked!');
  console.log(point)
  $('div.vote_count')[0].textContent = point
});

   

    $(function() {
    $('div.card-image').error(function() {
      $(this).attr({
        src: '/assets/default.png'
      });
    });
  });
</script>
<style>
div.vote_count, .vote_title, .select, div.timer{
  float:left;
}

</style>
